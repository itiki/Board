define(function(){return function(f){f.fn.extend({everyTime:function(b,a,c,d,e){return this.each(function(){f.timer.add(this,b,a,c,d,e)})},oneTime:function(b,a,c){return this.each(function(){f.timer.add(this,b,a,c,1)})},stopTime:function(b,a){return this.each(function(){f.timer.remove(this,b,a)})}});f.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(b){if(void 0==b||null==b)return null;var a=this.regex.exec(f.trim(b.toString()));
return a[2]?parseInt(a[1],10)*(this.powers[a[2]]||1):b},add:function(b,a,c,d,e,g){var h=0;f.isFunction(c)&&(e||(e=d),d=c,c=a);a=f.timer.timeParse(a);if(!("number"!=typeof a||isNaN(a)||0>=a)){e&&e.constructor!=Number&&(g=!!e,e=0);e=e||0;g=g||!1;b.$timers||(b.$timers={});b.$timers[c]||(b.$timers[c]={});d.$timerID=d.$timerID||this.guid++;var i=function(){if(!g||!this.inProgress)this.inProgress=!0,(++h>e&&0!==e||!1===d.call(b,h))&&f.timer.remove(b,c,d),this.inProgress=!1};i.$timerID=d.$timerID;b.$timers[c][d.$timerID]||
(b.$timers[c][d.$timerID]=window.setInterval(i,a));this.global[c]||(this.global[c]=[]);this.global[c].push(b)}},remove:function(b,a,c){var d=b.$timers,e;if(d){if(a){if(d[a]){if(c)c.$timerID&&(window.clearInterval(d[a][c.$timerID]),delete d[a][c.$timerID]);else for(c in d[a])window.clearInterval(d[a][c]),delete d[a][c];for(e in d[a])break;e||(e=null,delete d[a])}}else for(a in d)this.remove(b,a,c);for(e in d)break;e||(b.$timers=null)}}}});if(f.browser.msie)f(window).one("unload",function(){var b=f.timer.global,
a;for(a in b)for(var c=b[a],d=c.length;--d;)f.timer.remove(c[d],a)})}});
