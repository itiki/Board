define(["jquery","jquerypp/range","jquerypp/compare"],function(h){(function(i){var k=function(a){return a?a.ownerDocument.defaultView||a.ownerDocument.parentWindow:window},l=function(a){var e=i.Range.current(a).clone(),a=i.Range(a).select(a);if(!e.overlaps(a))return null;1>e.compare("START_TO_START",a)?(startPos=0,e.move("START_TO_START",a)):(fromElementToCurrent=a.clone(),fromElementToCurrent.move("END_TO_START",e),startPos=fromElementToCurrent.toString().length);endPos=0<=e.compare("END_TO_END",
a)?a.toString().length:startPos+e.toString().length;return{start:startPos,end:endPos}},h=function(a){var e=k(a);if(void 0!==a.selectionStart)return document.activeElement&&document.activeElement!=a&&a.selectionStart==a.selectionEnd&&0==a.selectionStart?{start:a.value.length,end:a.value.length}:{start:a.selectionStart,end:a.selectionEnd};if(e.getSelection)return l(a,e);try{if("input"==a.nodeName.toLowerCase()){var b=k(a).document.selection.createRange(),c=a.createTextRange();c.setEndPoint("EndToStart",
b);var d=c.text.length;return{start:d,end:d+b.text.length}}var f=l(a,e);if(!f)return f;var m=i.Range.current().clone(),g=m.clone().collapse().range,h=m.clone().collapse(!1).range;g.moveStart("character",-1);h.moveStart("character",-1);0!=f.startPos&&""==g.text&&(f.startPos+=2);0!=f.endPos&&""==h.text&&(f.endPos+=2);return f}catch(j){return{start:a.value.length,end:a.value.length}}},j=function(a,e,b){for(var c,d,b=b||0,f=0;a[f];f++)if(c=a[f],3===c.nodeType||4===c.nodeType){d=b;var h=b+=c.nodeValue.length,
g=e;"number"===typeof g[0]&&g[0]<h&&(g[0]={el:c,count:g[0]-d});"number"===typeof g[1]&&g[1]<=h&&(g[1]={el:c,count:g[1]-d})}else 8!==c.nodeType&&(b=j(c.childNodes,e,b));return b};i.fn.selection=function(a,e){return void 0!==a?this.each(function(){var b=e,c=k(this);if(this.setSelectionRange)void 0===b?(this.focus(),this.setSelectionRange(a,a)):(this.select(),this.selectionStart=a,this.selectionEnd=b);else if(this.createTextRange)c=this.createTextRange(),c.moveStart("character",a),b=b||a,c.moveEnd("character",
b-this.value.length),c.select();else if(c.getSelection){var d=c.document,c=c.getSelection(),d=d.createRange(),b=[a,void 0!==b?b:a];j([this],b);d.setStart(b[0].el,b[0].count);d.setEnd(b[1].el,b[1].count);c.removeAllRanges();c.addRange(d)}else c.document.body.createTextRange&&(d=document.body.createTextRange(),d.moveToElementText(this),d.collapse(),d.moveStart("character",a),d.moveEnd("character",void 0!==b?b:a),d.select())}):h(this[0])};i.fn.selection.getCharElement=j})(h)});
