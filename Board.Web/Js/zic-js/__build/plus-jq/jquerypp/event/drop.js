define("jquerypp/event/drag,jquerypp/within,jquerypp/compare,jquerypp/util/vector,jquerypp/event/livehack,jquery".split(","),function(o,p,q,r,s,l){(function(g){var n=g.event,m="dropover,dropon,dropout,dropinit,dropmove,dropend".split(",");g.Drop=function(a,b){l.extend(this,a);this.element=g(b)};g.each(m,function(){n.special[this]={add:function(){var a=g(this),b=a.data("dropEventCount")||0;a.data("dropEventCount",b+1);0==b&&g.Drop.addElement(this)},remove:function(){var a=g(this),b=a.data("dropEventCount")||
0;a.data("dropEventCount",b-1);1>=b&&g.Drop.removeElement(this)}}});g.extend(g.Drop,{lowerName:"drop",_rootElements:[],_elements:g(),last_active:[],endName:"dropon",addElement:function(a){for(var b=0;b<this._rootElements.length;b++)if(a==this._rootElements[b])return;this._rootElements.push(a)},removeElement:function(a){for(var b=0;b<this._rootElements.length;b++)if(a==this._rootElements[b]){this._rootElements.splice(b,1);break}},sortByDeepestChild:function(a,b){var c=a.element.compare(b.element);
return c&16||c&4?1:c&8||c&2?-1:0},isAffected:function(a,b,c){return c.element!=b.element&&1==c.element.within(a[0],a[1],c._cache).length},deactivate:function(a,b,c){b.out(c,a);a.callHandlers(this.lowerName+"out",a.element[0],c,b)},activate:function(a,b,c){b.over(c,a);a.callHandlers(this.lowerName+"over",a.element[0],c,b)},move:function(a,b,c){a.callHandlers(this.lowerName+"move",a.element[0],c,b)},compile:function(a,b){if(this.dragging||b){this.dragging||(this.dragging=b,this.last_active=[]);for(var c,
e,d,f,h=[],i=this.dragging,j=0;j<this._rootElements.length;j++)for(d in c=this._rootElements[j],e=g.event.findBySelector(c,m),e){f=d?l(d,c):[c];for(var k=0;k<f.length;k++)this.addCallbacks(f[k],e[d],i)&&h.push(f[k])}this.add(h,a,i)}},addCallbacks:function(a,b,c){var e=g.data(a,"_dropData");if(e){if(!c){for(var d in b)e[d]=e[d]?e[d].concat(b[d]):b[d];return!1}}else return g.data(a,"_dropData",new g.Drop(b,a)),!0},add:function(a,b,c){for(var e=0,d;e<a.length;)d=g.data(a[e],"_dropData"),d.callHandlers(this.lowerName+
"init",a[e],b,c),d._canceled?a.splice(e,1):e++;this._elements.push.apply(this._elements,a)},show:function(a,b,c){if(this._elements.length){for(var e=[],d=!0,f=0,h,i,j,k=this.last_active;f<this._elements.length;)(h=g.data(this._elements[f],"_dropData"))?(f++,this.isAffected(a,b,h)&&e.push(h)):this._elements.splice(f,1);e.sort(this.sortByDeepestChild);c.stopRespondPropagate=function(){d=!1};i=e.slice();this.last_active=e;for(a=0;a<k.length;a++){h=k[a];for(f=0;j=i[f];)if(h==j){i.splice(f,1);break}else f++;
j||this.deactivate(h,b,c);if(!d)return}for(f=0;f<i.length;f++)if(this.activate(i[f],b,c),!d)return;for(f=0;f<e.length&&!(this.move(e[f],b,c),!d);f++);}},end:function(a,b){for(var c,e=this.lowerName+"end",d=0;d<this.last_active.length;d++)c=this.last_active[d],this.isAffected(a.vector(),b,c)&&c[this.endName]&&c.callHandlers(this.endName,null,a,b);for(d=0;d<this._elements.length;d++)(c=g.data(this._elements[d],"_dropData"))&&c.callHandlers(e,null,a,b);this.clear()},clear:function(){this._elements.each(function(){g.removeData(this,
"_dropData")});this._elements=g();delete this.dragging}});g.Drag.responder=g.Drop;g.extend(g.Drop.prototype,{callHandlers:function(a,b,c,e){for(var d=this[a]?this[a].length:0,f=0;f<d;f++)this[a][f].call(b||this.element[0],c,this,e)},cache:function(a){this._cache=null!=a?a:!0},cancel:function(){this._canceled=!0}})})(l)});
