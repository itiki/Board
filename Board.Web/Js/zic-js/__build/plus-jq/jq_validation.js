define(function(q){var n=q("./../plus/cerd.js");return function(g,o){g.validationEngineLanguage={allRules:{equals:{alertText:"前后不一致！"},atlast:{alertText:"至少填写其中项！"},required:{alertText:"* 此项必填",alertTextCheckboxMultiple:"* 请选择",alertTextCheckboxe:"* 请先勾选同意本协议"},length:{alertText:"在 ",alertText2:" 到 ",alertText3:" 个字符间"},minSize:{alertText:"字符长度不得小于 ",alertText2:" 位"},maxSize:{alertText:"字符长度不得大于 ",alertText2:" 位"},maxCheckbox:{alertText:"* Checks allowed Exceeded"},minCheckbox:{alertText:"请选择至少",
alertText2:" 个选项"},idCard:{func:n.checkIsIdno},card_adult:{func:n.checkAdult},dateRegion:{func:function(a){a=a.replace("-","/");return new Date(a)<=new Date?"日期不能小于等于今天":"ok"}},continueSix:{func:function(a){for(var a=a.toLowerCase(),b,c=1,d=0;d<a.length;d++){if(a.charCodeAt(d)==b){if(c++,5<c)return"密码过于简单，不能连续6个及以上相同的字母或数字"}else c=1;b=a.charCodeAt(d)}return"ok"}},equalsSix:{func:function(a,b,c){for(var a=a.toLowerCase(),b=b.toLowerCase(),d=0;d<a.length;d++){var h=a.substr(d,6);if(6>h.length)break;
for(var f=0;f<b.length;f++){var e=b.substr(f,6);if(6>e.length)break;if(e==h)return"不允许连续6个及以上字符与"+c+"相同"}}return"ok"}},beMin:{func:function(a,b,c){return Number(a)<Number(b)?"不允许小于"+c:"ok"}},SHbeMin:{func:function(a,b,c,d,h){return 0!=Number(b)&&Number(a)<Number(d)?"不允许小于"+h:"ok"}},SHObeMin:{func:function(a,b,c,d,h){b=Number(b);return 0!=b&&b<Number(d)?c+"不允许小于"+h:"ok"}},noPullNumber:{func:function(a){return RegExp(/^[0-9]+$/).test(a)?"不能由纯数字组成":"ok"}},ajaxEmailExist:{url:window.urlprefix+"/people/check",
extraData:"email=eric",alertText:"* 这个email已被使用",alertTextLoad:"* 验证中, 请等待"},telephone:{regex:/^[0-9\-\(\)\ ]{7,}$/,alertText:"电话号码格式不正确"},validate:{regex:/^[0-9\-\(\)\ ]+$/,alertText:"验证码格式不正确"},email:{regex:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,
alertText:"Email格式不正确"},date:{regex:/^[0-9]{4}\-[0-9]{1,2}\-[0-9]{1,2}$/,alertText:"日期格式不正确，必须为'YYYY-MM-DD'格式"},chinese:{regex:/^[\u4e00-\u9fa5]+$/,alertText:"必须是中文"},onlyNumber:{regex:/^[0-9]+$/,alertText:"必须是数字"},onlyLetter:{regex:/^[a-zA-Z]+$/,alertText:"* 必须是英文字母"},userName:{regex:/^[a-zA-Z][0-9a-zA-Z]+$/,alertText:"* 必须是字母和数字内容，数字不允许开头"},price:{regex:/^[0-9]+(\.[0-9]{1,2})?$/,alertText:"价格格式不正确"},shared:{regex:/^[0-9]+(\.[0-9]{1,2})?$/,alertText:"份额格式不正确"},ipv4:{regex:/^((([01]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))[.]){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))$/,
alertText:"* 错误的 IP 地址"},url:{regex:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,
alertText:"* 错误的 URL"},postCode:{regex:/^\d{6}$/,alertText:"邮编格式不正确"},passWord:{regex:/^(\d+[a-zA-Z]\w*)|([a-zA-Z]+\d\w*)$/,alertText:"密码格式不正确"},passWordLogin:{regex:/^[0-9a-zA-z]{8,20}$/,alertText:"密码格式不正确，必须为8-20位数字或字母"},bankCard:{regex:/^[0-9]{8}$|^[0-9]{16}$|^[0-9]{18}|^[0-9]{19}$/,alertText:"银行卡格式不正确"},bankCardWithSpace:{regex:/^[0-9 ]{9}$|^[0-9 ]{19}$|^[0-9 ]{21}|^[0-9 ]{22}$/,alertText:"银行卡格式不正确"}}};var e={init:function(a){if(!this.data("jqv")||null==this.data("jqv"))e._saveOptions(this,a),
g(".formError").live("click",function(){g(this).fadeOut(150,function(){g(this).remove()})})},attach:function(a){a=a?e._saveOptions(this,a):this.data("jqv");if(!a.binded){var b=this.find("[class*=validate]");b.not("[type=checkbox]").not(".vali_delay").bind(a.validationEventTrigger,e._onFieldEvent).bind(a.un_validationEventTrigger,e._unFieldEvent);b.filter("[type=checkbox]").bind("click",e._onFieldEvent);b.filter(".vali_delay").bind(a.validationEventTrigger,e._delay_onFieldEvent);this.find("input[type=submit], .submit").not(".vali_skip").bind("click",
e._onSubmitEvent);a.binded=!0;a.autoPositionUpdate&&g(window).bind("resize",{noAnimation:!0,formElem:this},e.updatePromptsPosition)}return this},detach:function(){var a=this.data("jqv"),b=this.find("[class*=validate]");b.not("[type=checkbox]").not(".vali_delay").unbind(a.validationEventTrigger,e._onFieldEvent).unbind(a.un_validationEventTrigger,e._unFieldEvent);b.filter("[type=checkbox]").unbind("click",e._onFieldEvent);b.filter(".vali_delay").unbind(a.validationEventTrigger,e._delay_onFieldEvent);
this.find("input[type=submit], .submit").unbind("click",e.onAjaxFormComplete);this.removeData("jqv");a.autoPositionUpdate&&g(window).unbind("resize",e.updatePromptsPosition);return this},validate:function(){return e._validateFields(this)},validateField:function(a){var b=g(this).data("jqv"),a=e._validateField(g(a),b);if(b.onSuccess&&0==b.InvalidFields.length)b.onSuccess();else if(b.onFailure&&0<b.InvalidFields.length)b.onFailure();return a},validateform:function(){return e._onSubmitEvent.call(this)},
updatePromptsPosition:function(a){if(a&&this==window)var b=a.data.formElem,c=a.data.noAnimation;else b=g(this.closest("form"));var d=b.data("jqv");b.find("[class*=validate]").not(":hidden").not(":disabled").each(function(){var a=g(this),b=e._getPrompt(a),j=g(b).find(".formErrorContent").html();b&&e._updatePrompt(a,g(b),j,void 0,!1,d,c)});return this},showPrompt:function(a,b,c,d){var h=this.closest("form").data("jqv");h||(h=e._saveOptions(this,h));c&&(h.promptPosition=c);h.showArrow=!0==d;e._showPrompt(this,
a,b,!1,h)},hidePrompt:function(){var a="."+e._getClassName(g(this).data("vali_class"))+"formError";g(a).fadeTo("fast",0.3,function(){g(this).remove()})},closePrompt:function(a){return e._closePrompt(a)},hide:function(){var a;a=g(this).is("form")?"parentForm"+g(this).attr("id"):g(this).attr("id")+"formError";g("."+a).fadeTo("fast",0.3,function(){g(this).remove()})},hideAll:function(){g(".formError").fadeTo("fast",0.3,function(){g(this).remove()})},_saveOptions:function(a,b){var c=g.extend(!0,{allrules:g.validationEngineLanguage.allRules},
g.validationEngine.defaults,b);a.data("jqv",c);return c},_unFieldEvent:function(){e._closePrompt(g(this))},_onFieldEvent:function(a){var b=g(this),c=b.closest("form").data("jqv");window.setTimeout(function(){e._validateField(b,c);if(0==c.InvalidFields.length&&c.onSuccess)c.onSuccess();else if(0<c.InvalidFields.length&&c.onFailure)c.onFailure()},a.data?a.data.delay:0)},_delay_onFieldEvent:function(){var a=this,b=arguments;window.setTimeout(function(){e._onFieldEvent.apply(a,b)},1E3)},_onSubmitEvent:function(a){var b=
g(this).closest("form"),c=b.data("jqv"),d="";g(a.target).is("[class*=valitarget]")&&(d=/valitarget\[(.*)\]/.exec(g(a.target).attr("class"))[1]);if((a=e._validateFields(b,!0,d))&&c.ajaxFormValidation)return e._validateFormWithAjax(b,c),!1;return c.onValidationComplete?(c.onValidationComplete(b,a),!1):a},_checkAjaxStatus:function(a){var b=!0;g.each(a.ajaxValidCache,function(a,d){if(!d)return b=!1});return b},_validateFields:function(a,b,c){var d=a.data("jqv"),h=!1;a.trigger("jqv.form.validating");var f=
a.find("[class*=validate]").not(":hidden");c&&(f=f.filter(".valitarget_"+c));f.each(function(){h|=e._validateField(g(this),d,b)});a.trigger("jqv.form.result",[h]);if(!h)return!0;if(!d.scroll)return!1;for(var a=Number.MAX_VALUE,c=0,f=g(".formError:not('.greenPopup')"),j=0;j<f.length;j++){var k=g(f[j]).offset().top;k<a&&(a=k,c=g(f[j]).offset().left)}d.isOverflown?(f=g(d.overflownDIV),j=f.scrollTop(),k=-parseInt(f.offset().top),a+=j+k-5,g(d.overflownDIV+":not(:animated)").animate({scrollTop:a},1100),
g("html:not(:animated),body:not(:animated)").animate({scrollTop:f.offset().top,scrollLeft:c},1100)):g("html:not(:animated),body:not(:animated)").animate({scrollTop:a,scrollLeft:c},1100);return!1},_validateFormWithAjax:function(a,b){var c=a.serialize(),d=b.ajaxFormValidationURL?b.ajaxFormValidationURL:a.attr("action");g.ajax({type:"GET",url:d,cache:!1,dataType:"json",data:c,form:a,methods:e,options:b,beforeSend:function(){return b.onBeforeAjaxFormValidation(a,b)},error:function(a,b){e._ajaxError(a,
b)},success:function(c){if(!0!==c){for(var d=!1,j=0;j<c.length;j++){var k=c[j],l=g(g("#"+k[0])[0]);if(1==l.length){var i=k[2];!0==k[1]?""==i||!i?e._closePrompt(l):(b.allrules[i]&&(k=b.allrules[i].alertTextOk)&&(i=k),e._showPrompt(l,i,"pass",!1,b,!0)):(d|=1,b.allrules[i]&&(k=b.allrules[i].alertText)&&(i=k),e._showPrompt(l,i,"",!1,b,!0))}}b.onAjaxFormComplete(!d,a,c,b)}else b.onAjaxFormComplete(!0,a,"",b)}})},_validateField:function(a,b,c){var d=/validate\[(.*)\]/.exec(a.attr("class"));if(!d)return!1;
var h=d[1].split(/\[|,|\]/);if(""==a.val()){rules1=["required","atlast"];for(var f=0;f<h.length;f++)"atlast"==h[f]&&rules1.push(h[f+1]);h=o.intersection(h,rules1)}var d=g(a.closest("form")),j=!1,k=a.attr("name"),l="";b.isError=!1;b.showArrow=!0;for(f=0;f<h.length;f++){var i=void 0;switch(h[f]){case "required":i=e._required(a,h,f,b);break;case "custom":i=e._customRegex(a,h,f,b);break;case "ajax":c||(e._ajax(a,h,f,b),j=!0);break;case "minSize":i=e._minSize(a,h,f,b);break;case "maxSize":i=e._maxSize(a,
h,f,b);break;case "min":i=e._min(a,h,f,b);break;case "max":i=e._max(a,h,f,b);break;case "past":i=e._past(a,h,f,b);break;case "future":i=e._future(a,h,f,b);break;case "dateRange":var m="[class*="+h[f+1]+"]",p=d.find(m).eq(0),m=d.find(m).eq(1);if(p[0].value||m[0].value)i=e._dateRange(p,m,h,f,b);i&&(required=!0);b.showArrow=!1;break;case "maxCheckbox":i=e._maxCheckbox(a,h,f,b);a=g(g("input[name='"+k+"']"));break;case "minCheckbox":i=e._minCheckbox(a,h,f,b);a=k.substring(0,k.length-1);a=g(g("input[name^='"+
a+"']"));break;case "equals":i=e._equals(a,h,f,b);break;case "func":i=e._funcCall(a,h,f,b);break;case "compareFunc":i=e._compareFunc(a,h,f,b);break;case "compareOthers":i=e._compareOthers(a,h,f,b);break;case "atlast":i=e._atlast(a,h,f,b)}void 0!==i&&(l+=i+"<br/>",b.isError=!0)}c=a.attr("type");if(("radio"==c||"checkbox"==c)&&1<g("input[name='"+k+"']").size())a=g(g("input[name='"+k+"'][type!=hidden]:first")),b.showArrow=!1;"text"==c&&1<d.find("input[name='"+k+"']").size()&&(a=g(d.find("input[name='"+
k+"'][type!=hidden]:first")),b.showArrow=!1);b.isError?e._showPrompt(a,l,"",!1,b):j||e._closePrompt(a);j||a.trigger("jqv.field.result",[a,b.isError,l]);c=g.inArray(a[0],b.InvalidFields);-1==c?b.isError&&b.InvalidFields.push(a[0]):b.isError||b.InvalidFields.splice(c,1);return b.isError},_required:function(a,b,c,d){switch(a.attr("type")){default:if(!a.val())return d.allrules[b[c]].alertText;break;case "radio":case "checkbox":a=a.attr("name");if(0==g("input[name='"+a+"']:checked").size())return 1==g("input[name='"+
a+"']").size()?d.allrules[b[c]].alertTextCheckboxe:d.allrules[b[c]].alertTextCheckboxMultiple;break;case "select-one":if(!a.val())return d.allrules[b[c]].alertText;break;case "select-multiple":if(!a.find("option:selected").val())return d.allrules[b[c]].alertText}},_customRegex:function(a,b,c,d){b=b[c+1];if(c=d.allrules[b]){if((c=c.regex)&&!RegExp(c).test(a.val()))return d.allrules[b].alertText}else alert("jqv:custom rule not found "+b)},_funcCall:function(a,b,c,d){b=b[c+1];a=d.allrules[b].func(a.val());
if(""!=a&&"ok"!=a)return d.allrules[b].alertText?d.allrules[b].alertText:a},_equals:function(a,b,c,d){b=b[c+1];if(a.val()!=g("#"+b).val())return d.allrules.equals.alertText},_compareFunc:function(a,b,c,d){var e=b[c+1],b=g("#"+b[c+2]),a=d.allrules[e].func(a.val(),b.val()||b.text(),b.attr("title"));if(""!=a&&"ok"!=a)return d.allrules[e].alertText?d.allrules[e].alertText:a},_compareOthers:function(a,b,c,d){var e=b[c+1],f=g("#"+b[c+2]),b=g("#"+b[c+3]),a=d.allrules[e].func(a.val(),f.val()||f.text(),f.attr("title"),
b.val()||b.text(),b.attr("title"));if(""!=a&&"ok"!=a)return d.allrules[e].alertText?d.allrules[e].alertText:a},_atlast:function(a,b,c,d){var b=b[c+1],a=a.closest("form"),a=g("input[class*='atlast["+b+"]']",a),e=!1;a.each(function(){if(""!=g(this).val())return e=!0,!1});if(!e){var f="";a.each(function(){f+=g(this).attr("title");f+=","});return f+d.allrules.atlast.alertText}},_maxSize:function(a,b,c,d){b=parseFloat(b[c+1]);if(a.val().length>b)return a=d.allrules.maxSize,a.alertText+b+a.alertText2},
_minSize:function(a,b,c,d){b=parseFloat(b[c+1]);if(a.val().length<b)return a=d.allrules.minSize,a.alertText+b+a.alertText2},_min:function(a,b,c){b=parseFloat(b[c+1]);if(parseFloat(a.val())<b)return"不得小于"+b},_max:function(a,b,c){b=parseFloat(b[c+1]);if(parseFloat(a.val())>b)return"不得大于"+b},_past:function(a,b,c,d){b=b[c+1];b="now"==b.toLowerCase()?new Date:e._parseDate(b);if(e._parseDate(a.val())<b)return a=d.allrules.past,a.alertText2?a.alertText+e._dateToString(b)+a.alertText2:a.alertText+e._dateToString(b)},
_future:function(a,b,c,d){b=b[c+1];b="now"==b.toLowerCase()?new Date:e._parseDate(b);if(e._parseDate(a.val())>b)return a=d.allrules.future,a.alertText2?a.alertText+e._dateToString(b)+a.alertText2:a.alertText+e._dateToString(b)},_isDate:function(a){return RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/).test(a)?
!0:!1},_dateCompare:function(a,b){return new Date(a.toString())<new Date(b.toString())},_dateRange:function(a,b,c,d,g){if(!a[0].value&&b[0].value||a[0].value&&!b[0].value||!e._isDate(a[0].value)||!e._isDate(b[0].value)||!e._dateCompare(a[0].value,b[0].value))return g.allrules[c[d]].alertText+g.allrules[c[d]].alertText2},_maxCheckbox:function(a,b,c,d){b=b[c+1];a=a.attr("name");if(g("input[name='"+a+"']:checked").size()>b)return d.showArrow=!1,d.allrules.maxCheckbox.alertText2?d.allrules.maxCheckbox.alertText+
" "+b+" "+d.allrules.maxCheckbox.alertText2:d.allrules.maxCheckbox.alertText},_minCheckbox:function(a,b,c,d){b=b[c+1];a=a.attr("name");a=a.substring(0,a.length-1);if(g("input[name^='"+a+"']:checked").size()<b)return d.showArrow=!1,d.allrules.minCheckbox.alertText+" "+b+" "+d.allrules.minCheckbox.alertText2},_ajax:function(a,b,c,d){var h=d.allrules[b[c+1]],b=h.extraData,c=h.extraDataDynamic;b||(b="");if(c){for(var f=[],j=(""+c).split(","),c=0;c<j.length;c++){var k=j[c];if(g(k).length){var l=a.closest("form").find(k).val(),
k=k.replace("#","")+"="+escape(l);f.push(k)}}c=f.join("&")}else c="";d.isError||g.ajax({type:"GET",url:h.url,cache:!1,dataType:"json",data:"fieldId="+a.attr("id")+"&fieldValue="+a.val()+"&extraData="+b+"&"+c,field:a,rule:h,methods:e,options:d,beforeSend:function(){var b=h.alertTextLoad;b&&e._showPrompt(a,b,"load",!0,d)},error:function(a,b){e._ajaxError(a,b)},success:function(a){var b=a[0],c=g(g("#"+b)[0]);if(1==c.length){var f=a[2];a[1]?(void 0!==d.ajaxValidCache[b]&&(d.ajaxValidCache[b]=!0),f?d.allrules[f]&&
(a=d.allrules[f].alertTextOk)&&(f=a):f=h.alertTextOk,f?e._showPrompt(c,f,"pass",!0,d):e._closePrompt(c)):(d.ajaxValidCache[b]=!1,d.isError=!0,f?d.allrules[f]&&(a=d.allrules[f].alertText)&&(f=a):f=h.alertText,e._showPrompt(c,f,"",!0,d))}}})},_ajaxError:function(a,b){0==a.status&&null==b?alert("The page is not served from a server! ajax call failed"):"undefined"!=typeof console&&console.log("Ajax error: "+a.status+" "+b)},_dateToString:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},
_parseDate:function(a){var b=a.split("-");b==a&&(b=a.split("/"));return new Date(b[0],b[1]-1,b[2])},_showPrompt:function(a,b,c,d,g,f){var j=e._getPrompt(a);f&&(j=!1);j?e._updatePrompt(a,j,b,c,d,g):e._buildPrompt(a,b,c,d,g)},_fixPromptWidth:function(a,b){var c=0;o.each(a.split("<br/>"),function(a){a.length>c&&(c=a.length)});b.width(12*c)},_buildPrompt:function(a,b,c,d,h){var f=/valiarr\[(.*)\]/.exec(a.attr("class"));f?a.data("valiarr",f[1].split(/\[|,|\]/)[0]):a.data("valiarr",h.promptPosition);a.attr("id")?
a.data("vali_class",a.attr("id")):a.data("vali_class","jqvali_"+11*Math.random());var j=function(b){b.addClass(e._getClassName(a.data("vali_class"))+"formError");a.is(":input")&&b.addClass("parentForm"+e._getClassName(a.parents("form").attr("id")))};if("kissy"==h.promptModel){f=g("<span class='valid-kissy'></span>");j(f);switch(c){case "pass":f.addClass("ok");break;default:f.addClass("error")}c=g("<b>").html(b).appendTo(f);a.next("span.valid-kissy").remove();a.after(f)}else{f=g("<div>");j(f);f.addClass("formError");
switch(c){case "pass":f.addClass("greenPopup");break;case "load":f.addClass("blackPopup")}d&&f.addClass("ajaxed");c=g("<div>").addClass("formErrorContent").html(b).appendTo(f);e._fixPromptWidth(b,c);if(h.showArrow)switch(b=g("<div>").addClass("formErrorArrow"),a.data("valiarr")){case "bottomLeft":case "bottomRight":f.find(".formErrorContent").before(b);b.addClass("formErrorArrowBottom").html('<div class="line1"><\!-- --\></div><div class="line2"><\!-- --\></div><div class="line3"><\!-- --\></div><div class="line4"><\!-- --\></div><div class="line5"><\!-- --\></div><div class="line6"><\!-- --\></div><div class="line7"><\!-- --\></div><div class="line8"><\!-- --\></div><div class="line9"><\!-- --\></div><div class="line10"><\!-- --\></div>');
break;case "topLeft":case "topRight":b.html('<div class="line10"><\!-- --\></div><div class="line9"><\!-- --\></div><div class="line8"><\!-- --\></div><div class="line7"><\!-- --\></div><div class="line6"><\!-- --\></div><div class="line5"><\!-- --\></div><div class="line4"><\!-- --\></div><div class="line3"><\!-- --\></div><div class="line2"><\!-- --\></div><div class="line1"><\!-- --\></div>'),f.append(b)}h.isOverflown?a.before(f):g("body").append(f);h=e._calculatePosition(a,f,h);f.css({top:h.callerTopPosition,
left:h.callerleftPosition,marginTop:h.marginTopSize,opacity:0});return f.animate({opacity:0.87})}},_updatePrompt:function(a,b,c,d,g,f){if(b)if("kissy"==f.promptModel){b.removeClass("ok error");switch(d){case "pass":b.addClass("ok");break;default:b.addClass("error")}b.find("b").html(c)}else e._fixPromptWidth(c,b.children(".formErrorContent")),"pass"==d?b.addClass("greenPopup"):b.removeClass("greenPopup"),"load"==d?b.addClass("blackPopup"):b.removeClass("blackPopup"),g?b.addClass("ajaxed"):b.removeClass("ajaxed"),
b.find(".formErrorContent").html(c),a=e._calculatePosition(a,b,f),b.animate({top:a.callerTopPosition,marginTop:a.marginTopSize})},_closePrompt:function(a){var b=e._getPrompt(a);b&&b.fadeTo("fast",0,function(){b.remove()})},_getPrompt:function(a){if(a.data("vali_class")&&(a="."+e._getClassName(a.data("vali_class"))+"formError",a=g(a)[0]))return g(a)},_calculatePosition:function(a,b,c){var d,e,f=a.width(),b=b.height(),g=c.isOverflown;g?(c=d=0,e=-b):(d=a.offset(),c=d.top,d=d.left,e=0);switch(a.data("valiarr")){default:case "topRight":g?
d+=f-30:(d+=f-30,c+=-b);break;case "topLeft":c+=-b-0;break;case "centerRight":d+=f+13;break;case "bottomLeft":c=c+a.height()+15;break;case "bottomRight":d+=f-30,c+=a.height()+5}return{callerTopPosition:c+"px",callerleftPosition:d+"px",marginTopSize:e+"px"}},_getClassName:function(a){return a.replace(":","_").replace(".","_")}};g.fn.validationEngine=function(a){var b=g(this);if(!b[0])return!1;if("string"==typeof a&&"_"!=a.charAt(0)&&e[a])return"showPrompt"!=a&&"hidePrompt"!=a&&"hide"!=a&&"hideAll"!=
a&&e.init.apply(b),e[a].apply(b,Array.prototype.slice.call(arguments,1));e.init.apply(b,arguments);return e.attach.apply(b)};g.validationEngine={defaults:{validationEventTrigger:"blur",un_validationEventTrigger:"click",scroll:!0,promptModel:"float",promptPosition:"centerRight",inlineAjax:!1,ajaxFormValidation:!1,ajaxFormValidationURL:!1,onAjaxFormComplete:g.noop,onBeforeAjaxFormValidation:g.noop,onValidationComplete:!1,isOverflown:!1,overflownDIV:"",binded:!1,showArrow:!0,isError:!1,ajaxValidCache:{},
autoPositionUpdate:!1,InvalidFields:[],onSuccess:!1,onFailure:!1}}}});
