define(function(){return function(a){a.extend({createUploadIframe:function(b,c){var d="jUploadFrame"+b,e='<iframe id="'+d+'" name="'+d+'" style="position:absolute; top:-9999px; left:-9999px"';window.ActiveXObject&&("boolean"==typeof c?e+=' src="javascript:false"':"string"==typeof c&&(e+=' src="'+c+'"'));a(e+" />").appendTo(document.body);return a("#"+d).get(0)},createUploadForm:function(b,c,d){var e="jUploadForm"+b,b="jUploadFile"+b,e=a('<form  action="" method="POST" name="'+e+'" id="'+e+'" enctype="multipart/form-data"></form>');
if(d)for(var i in d)a('<input type="hidden" name="'+i+'" value="'+d[i]+'" />').appendTo(e);c=a("#"+c);d=a(c).clone();a(c).attr("id",b);a(c).before(d);a(c).appendTo(e);a(e).css("position","absolute");a(e).css("top","-1200px");a(e).css("left","-1200px");a(e).appendTo("body");return e},ajaxFileUpload:function(b){var b=a.extend({},a.ajaxSettings,b),c=(new Date).getTime(),d=a.createUploadForm(c,b.fileElementId,"undefined"==typeof b.data?!1:b.data);a.createUploadIframe(c,b.secureuri);var e="jUploadFrame"+
c,c="jUploadForm"+c;b.global&&!a.active++&&a.event.trigger("ajaxStart");var i=!1,f={};b.global&&a.event.trigger("ajaxSend",[f,b]);var j=function(c){var g=document.getElementById(e);try{g.contentWindow?(f.responseText=g.contentWindow.document.body?g.contentWindow.document.body.innerHTML:null,f.responseXML=g.contentWindow.document.XMLDocument?g.contentWindow.document.XMLDocument:g.contentWindow.document):g.contentDocument&&(f.responseText=g.contentDocument.document.body?g.contentDocument.document.body.innerHTML:
null,f.responseXML=g.contentDocument.document.XMLDocument?g.contentDocument.document.XMLDocument:g.contentDocument.document)}catch(j){a.handleError(b,f,null,j)}if(f||"timeout"==c){i=!0;var h;try{if(h="timeout"!=c?"success":"error","error"!=h){var k=a.uploadHttpData(f,b.dataType);b.success&&b.success(k,h);b.global&&a.event.trigger("ajaxSuccess",[f,b])}else a.handleError(b,f,h)}catch(l){h="error",a.handleError(b,f,h,l)}b.global&&a.event.trigger("ajaxComplete",[f,b]);b.global&&!--a.active&&a.event.trigger("ajaxStop");
b.complete&&b.complete(f,h);a(g).unbind();setTimeout(function(){try{a(g).remove(),a(d).remove()}catch(c){a.handleError(b,f,null,c)}},100);f=null}};0<b.timeout&&setTimeout(function(){i||j("timeout")},b.timeout);try{d=a("#"+c),a(d).attr("action",b.url),a(d).attr("method","POST"),a(d).attr("target",e),d.encoding?a(d).attr("encoding","multipart/form-data"):a(d).attr("enctype","multipart/form-data"),a(d).submit()}catch(k){a.handleError(b,f,null,k)}a("#"+e).load(j);return{abort:function(){}}},uploadHttpData:function(b,
c){var d;d="xml"==c||!c?b.responseXML:b.responseText;"script"==c&&a.globalEval(d);"json"==c&&eval("data = "+d);"html"==c&&a("<div>").html(d).evalScripts();return d}})}});
