define(function(){return function(c){c.fn.rater=function(d){var a={enabled:!0,url:"",method:"post",min:1,max:3,step:1,value:null,after_click:null,before_ajax:null,after_ajax:null,title_format:null,image:"/css/mod/img/star.gif",width:25,height:25};d&&c.extend(a,d);d=c('<ul class="rater-star"></ul>');d.css("background-image","url("+a.image+")");d.css("height",a.height);d.css("width",a.width*a.step*(a.max-a.min+a.step)/a.step);var b=c('<li class="rater-star-item-current"></li>');b.css("background-image",
"url("+a.image+")");b.css("height",a.height);b.css("width",0);b.css("z-index",a.max/a.step+1);a.value&&b.css("width",((a.value-a.min)/a.step+1)*a.step*a.width);d.append(b);for(var e=a.min;e<=a.max;e+=a.step)b=c('<li class="rater-star-item"></li>'),"function"==typeof a.title_format?b.attr("title",a.title_format(e)):b.attr("title",e),b.css("height",a.height),b.css("width",(e-a.min+a.step)*a.width),b.css("z-index",(a.max-e)/a.step+1),b.css("background-image","url("+a.image+")"),a.enabled||b.hide(),d.append(b);
d.mouseover(function(){a.enabled&&c(this).find(".rater-star-item-current").hide()}).mouseout(function(){c(this).find(".rater-star-item-current").show()});d.find(".rater-star-item").mouseover(function(){c(this).attr("class","rater-star-item-hover")}).mouseout(function(){c(this).attr("class","rater-star-item")}).click(function(){c(this).prevAll(".rater-star-item-current").css("width",c(this).width());var b=a.max-a.min+a.step,d=c(this).prevAll(".rater-star-item").size()+1,e={value:a.min+(d-1)*a.step,
number:d,count:b,min:a.min,max:a.max};"function"==typeof a.after_click&&a.after_click(e);a.url&&c.ajax({data:e,type:a.method,url:a.url,beforeSend:function(){"function"==typeof a.before_ajax&&a.before_ajax(e)},success:function(b){"function"==typeof a.after_ajax&&(e.ajax=b,a.after_ajax(e))}})});c(this).html(d)}}});
