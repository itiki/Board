define(function(){return function(e){(function(c){var e=0,d=!1;c.widget("ui.popup",{version:"@VERSION",options:{position:{my:"left top",at:"left bottom"},managed:!1,expandOnFocus:!1,show:{effect:"show",duration:"fast"},hide:{effect:"hide",duration:"fast"}},_create:function(){this.options.trigger||(this.options.trigger=this.element.prev());this.element.attr("id")||(this.element.attr("id","ui-popup-"+e++),this.generatedId=!0);!this.element.attr("role")&&!this.options.managed&&(this.element.attr("role",
"dialog"),this.generatedRole=!0);this.options.trigger.attr("aria-haspopup","true").attr("aria-owns",this.element.attr("id"));this.element.addClass("ui-popup");this._beforeClose();this.element.hide();this._bind(this.options.trigger,{keydown:function(a){switch(a.keyCode){case c.ui.keyCode.TAB:this.element.hide();this.close(a);break;case c.ui.keyCode.ESCAPE:this.isOpen&&this.close(a);break;case c.ui.keyCode.SPACE:this.options.trigger.is("a:ui-button")?a.preventDefault():this.options.trigger.is("a:not(:ui-button)")&&
this.options.trigger.trigger("click",a);break;case c.ui.keyCode.DOWN:case c.ui.keyCode.UP:a.preventDefault(),clearTimeout(this.closeTimer),this._delay(function(){this.open(a);this.focusPopup(a)},1)}},click:function(a){a.stopPropagation();a.preventDefault()},mousedown:function(a){var b=!1;c(a.target).is("input")&&(b=!0);this.isOpen?(d=!0,this.close()):(this.open(a),clearTimeout(this.closeTimer),this._delay(function(){b||this.focusPopup()},1))}});this.options.expandOnFocus&&this._bind(this.options.trigger,
{focus:function(a){d||this._delay(function(){this.isOpen||this.open(a)},1);this._delay(function(){d=!1},100)},blur:function(){d=!1}});this.options.managed||this._bind({keydown:function(a){if(a.keyCode===c.ui.keyCode.TAB){var b=c(":tabbable",this.element),d=b.first(),b=b.last();a.target===b[0]&&!a.shiftKey?(d.focus(1),a.preventDefault()):a.target===d[0]&&a.shiftKey&&(b.focus(1),a.preventDefault())}}});this._bind({focusout:function(a){this.closeTimer=this._delay(function(){this.close(a)},150)},focusin:function(){clearTimeout(this.closeTimer)},
mouseup:function(){clearTimeout(this.closeTimer)}});this._bind({keyup:function(a){a.keyCode==c.ui.keyCode.ESCAPE&&this.element.is(":visible")&&(this.close(a),this.focusTrigger())}});this._bind(this.document,{click:function(a){this.isOpen&&!c(a.target).closest(this.element.add(this.options.trigger)).length&&this.close(a)}})},_destroy:function(){this.element.show().removeClass("ui-popup").removeAttr("aria-hidden").removeAttr("aria-expanded").unbind("keypress.ui-popup");this.options.trigger.removeAttr("aria-haspopup").removeAttr("aria-owns");
this.generatedId&&this.element.removeAttr("id");this.generatedRole&&this.element.removeAttr("role")},open:function(a){var b=c.extend({},{of:this.options.trigger},this.options.position);this._show(this.element,this.options.show);this.element.attr("aria-hidden","false").attr("aria-expanded","true").position(b);this.options.trigger.attr("tabindex",-1);this.isOpen=!0;this._trigger("open",a)},focusPopup:function(a){if(!this.options.managed){var b=this.element.find(":tabbable");this.removeTabIndex=!1;b.length||
(this.element.is(":tabbable")||(this.element.attr("tabindex","0"),this.removeTabIndex=!0),b=b.add(this.element[0]));b.first().focus(1)}this._trigger("focusPopup",a)},focusTrigger:function(a){d=!0;this.options.trigger.focus();this._trigger("focusTrigger",a)},close:function(a){this._beforeClose();this._hide(this.element,this.options.hide);this.options.trigger.attr("tabindex",0);this.removeTabIndex&&this.element.removeAttr("tabindex");this.isOpen=!1;this._trigger("close",a)},_beforeClose:function(){this.element.attr("aria-hidden",
"true").attr("aria-expanded","false")}})})(e)}});
