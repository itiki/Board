define(function(){return function(r){(function(d,s){function A(a,c,b){return[parseInt(a[0],10)*(t.test(a[0])?c/100:1),parseInt(a[1],10)*(t.test(a[1])?b/100:1)]}function v(a,c){return parseInt(d.css(a,c),10)||0}d.ui=d.ui||{};var o,w=Math.max,m=Math.abs,B=Math.round,x=/left|center|right/,y=/top|center|bottom/,C=/[\+\-]\d+%?/,D=/^\w+/,t=/%$/,E=d.fn.position;d.position={scrollbarWidth:function(){if(o!==s)return o;var a,c,b=d("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>");
c=b.children()[0];d("body").append(b);a=c.offsetWidth;b.css("overflow","scroll");c=c.offsetWidth;a===c&&(c=b[0].clientWidth);b.remove();return o=a-c},getScrollInfo:function(a){var c=a.isWindow?"":a.element.css("overflow-x"),b=a.isWindow?"":a.element.css("overflow-y"),b="scroll"===b||"auto"===b&&a.height<a.element[0].scrollHeight;return{width:"scroll"===c||"auto"===c&&a.width<a.element[0].scrollWidth?d.position.scrollbarWidth():0,height:b?d.position.scrollbarWidth():0}},getWithinInfo:function(a){var a=
d(a||window),c=d.isWindow(a[0]);return{element:a,isWindow:c,offset:a.offset()||{left:0,top:0},scrollLeft:a.scrollLeft(),scrollTop:a.scrollTop(),width:c?a.width():a.outerWidth(),height:c?a.height():a.outerHeight()}}};d.fn.position=function(a){if(!a||!a.of)return E.apply(this,arguments);var a=d.extend({},a),c,b,e,k,g,f=d(a.of),l=d.position.getWithinInfo(a.within),j=d.position.getScrollInfo(l),h=f[0],u=(a.collision||"flip").split(" "),o={};9===h.nodeType?(b=f.width(),e=f.height(),k={top:0,left:0}):d.isWindow(h)?
(b=f.width(),e=f.height(),k={top:f.scrollTop(),left:f.scrollLeft()}):h.preventDefault?(a.at="left top",b=e=0,k={top:h.pageY,left:h.pageX}):(b=f.outerWidth(),e=f.outerHeight(),k=f.offset());g=d.extend({},k);d.each(["my","at"],function(){var b=(a[this]||"").split(" "),c,e;1===b.length&&(b=x.test(b[0])?b.concat(["center"]):y.test(b[0])?["center"].concat(b):["center","center"]);b[0]=x.test(b[0])?b[0]:"center";b[1]=y.test(b[1])?b[1]:"center";c=C.exec(b[0]);e=C.exec(b[1]);o[this]=[c?c[0]:0,e?e[0]:0];a[this]=
[D.exec(b[0])[0],D.exec(b[1])[0]]});1===u.length&&(u[1]=u[0]);"right"===a.at[0]?g.left+=b:"center"===a.at[0]&&(g.left+=b/2);"bottom"===a.at[1]?g.top+=e:"center"===a.at[1]&&(g.top+=e/2);c=A(o.at,b,e);g.left+=c[0];g.top+=c[1];return this.each(function(){var h,r,n=d(this),p=n.outerWidth(),q=n.outerHeight(),s=v(this,"marginLeft"),t=v(this,"marginTop"),x=p+s+v(this,"marginRight")+j.width,y=q+t+v(this,"marginBottom")+j.height,i=d.extend({},g),z=A(o.my,n.outerWidth(),n.outerHeight());"right"===a.my[0]?i.left-=
p:"center"===a.my[0]&&(i.left-=p/2);"bottom"===a.my[1]?i.top-=q:"center"===a.my[1]&&(i.top-=q/2);i.left+=z[0];i.top+=z[1];d.support.offsetFractions||(i.left=B(i.left),i.top=B(i.top));h={marginLeft:s,marginTop:t};d.each(["left","top"],function(f,k){if(d.ui.position[u[f]])d.ui.position[u[f]][k](i,{targetWidth:b,targetHeight:e,elemWidth:p,elemHeight:q,collisionPosition:h,collisionWidth:x,collisionHeight:y,offset:[c[0]+z[0],c[1]+z[1]],my:a.my,at:a.at,within:l,elem:n})});d.fn.bgiframe&&n.bgiframe();a.using&&
(r=function(c){var d=k.left-i.left,g=d+b-p,h=k.top-i.top,j=h+e-q,l={target:{element:f,left:k.left,top:k.top,width:b,height:e},element:{element:n,left:i.left,top:i.top,width:p,height:q},horizontal:0>g?"left":0<d?"right":"center",vertical:0>j?"top":0<h?"bottom":"middle"};b<p&&m(d+g)<b&&(l.horizontal="center");e<q&&m(h+j)<e&&(l.vertical="middle");l.important=w(m(d),m(g))>w(m(h),m(j))?"horizontal":"vertical";a.using.call(this,c,l)});n.offset(d.extend(i,{using:r}))})};d.ui.position={fit:{left:function(a,
c){var b=c.within,e=b.isWindow?b.scrollLeft:b.offset.left,d=b.width,g=a.left-c.collisionPosition.marginLeft,b=e-g,f=g+c.collisionWidth-d-e;c.collisionWidth>d?0<b&&0>=f?(e=a.left+b+c.collisionWidth-d-e,a.left+=b-e):a.left=0<f&&0>=b?e:b>f?e+d-c.collisionWidth:e:a.left=0<b?a.left+b:0<f?a.left-f:w(a.left-g,a.left)},top:function(a,c){var b=c.within,e=b.isWindow?b.scrollTop:b.offset.top,d=c.within.height,g=a.top-c.collisionPosition.marginTop,b=e-g,f=g+c.collisionHeight-d-e;c.collisionHeight>d?0<b&&0>=f?
(e=a.top+b+c.collisionHeight-d-e,a.top+=b-e):a.top=0<f&&0>=b?e:b>f?e+d-c.collisionHeight:e:a.top=0<b?a.top+b:0<f?a.top-f:w(a.top-g,a.top)}},flip:{left:function(a,c){var b=c.within,e=b.offset.left+b.scrollLeft,d=b.width,g=b.isWindow?0:b.offset.left,f=a.left-c.collisionPosition.marginLeft,b=f-g,l=f+c.collisionWidth-d-g,f="left"===c.my[0]?-c.elemWidth:"right"===c.my[0]?c.elemWidth:0,j="left"===c.at[0]?c.targetWidth:"right"===c.at[0]?-c.targetWidth:0,h=-2*c.offset[0];if(0>b){if(e=a.left+f+j+h+c.collisionWidth-
d-e,0>e||e<m(b))a.left+=f+j+h}else if(0<l&&(e=a.left-c.collisionPosition.marginLeft+f+j+h-g,0<e||m(e)<l))a.left+=f+j+h},top:function(a,c){var b=c.within,e=b.offset.top+b.scrollTop,d=b.height,g=b.isWindow?0:b.offset.top,f=a.top-c.collisionPosition.marginTop,b=f-g,l=f+c.collisionHeight-d-g,f="top"===c.my[1]?-c.elemHeight:"bottom"===c.my[1]?c.elemHeight:0,j="top"===c.at[1]?c.targetHeight:"bottom"===c.at[1]?-c.targetHeight:0,h=-2*c.offset[1];if(0>b){if(e=a.top+f+j+h+c.collisionHeight-d-e,a.top+f+j+h>
b&&(0>e||e<m(b)))a.top+=f+j+h}else if(0<l&&(e=a.top-c.collisionPosition.marginTop+f+j+h-g,a.top+f+j+h>l&&(0<e||m(e)<l)))a.top+=f+j+h}},flipfit:{left:function(){d.ui.position.flip.left.apply(this,arguments);d.ui.position.fit.left.apply(this,arguments)},top:function(){d.ui.position.flip.top.apply(this,arguments);d.ui.position.fit.top.apply(this,arguments)}}};(function(){var a,c,b,e,k=document.getElementsByTagName("body")[0];b=document.createElement("div");a=document.createElement(k?"div":"body");c=
{visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};k&&d.extend(c,{position:"absolute",left:"-1000px",top:"-1000px"});for(e in c)a.style[e]=c[e];a.appendChild(b);c=k||document.documentElement;c.insertBefore(a,c.firstChild);b.style.cssText="position: absolute; left: 10.7432222px;";b=d(b).offset().left;d.support.offsetFractions=10<b&&11>b;a.innerHTML="";c.removeChild(a)})();!1!==d.uiBackCompat&&function(a){var c=a.fn.position;a.fn.position=function(b){if(!b||!b.offset)return c.call(this,
b);var e=b.offset.split(" "),d=b.at.split(" ");1===e.length&&(e[1]=e[0]);/^\d/.test(e[0])&&(e[0]="+"+e[0]);/^\d/.test(e[1])&&(e[1]="+"+e[1]);1===d.length&&(/left|center|right/.test(d[0])?d[1]="center":(d[1]=d[0],d[0]="center"));return c.call(this,a.extend(b,{at:d[0]+e[0]+" "+d[1]+e[1],offset:s}))}}(r)})(r)}});
