define(function(){return function(e){e.fn.extend({countable:function(i){return this.each(function(){function f(){var d=g.val(),c=d==a.defaultText?0:d.length,d=c/a.maxLength,c=a.maxLength-c,f;void 0!=h&&c==h||(b.is(":hidden")&&d>=a.threshold&&b.show(),b.is(":visible")&&d<a.threshold&&b.hide(),e.support.opacity&&(f=a.startOpacity+(a.threshold-d)*(2*a.startOpacity-2),b.stop().fadeTo(a.fadeDuration,d>=a.threshold?f:0)),0<=c?b.is("."+a.maxClassName)&&b.html(a.positiveCopy.replace("{n}",'<span class="num"></span>')):
b.is("."+a.maxClassName)||b.html(a.negativeCopy.replace("{n}",'<span class="num"></span>')),b[(0>c?"add":"remove")+"Class"](a.maxClassName),b.find(".num").text(Math.abs(c)),-1==c||1==c?b.html(b.html().replace(/characters\b/,"character")):b.html(b.html().replace(/character\b/,"characters")),h=c)}var g=e(this),h,b,a=e.extend({threshold:0.5,appendMethod:"insertAfter",target:g,startOpacity:0.25,maxLength:parseInt(g.attr("maxlength"),10)||0,maxClassName:"maxed",className:"counter",tagName:"span",interval:750,
positiveCopy:"You have {n}&nbsp;characters left.",negativeCopy:"You are {n}&nbsp;characters over.",fadeDuration:"normal",defaultText:""},i);b=e("<"+a.tagName+"/>").html(a.positiveCopy.replace("{n}",'<span class="num"></span>')).addClass(a.className);e.support.opacity&&b.css({opacity:0});b[a.appendMethod](a.target);g.bind("keyup",f).bind("focus blur",function(b){"blur"==b.type&&clearInterval(void 0);"focus"==b.type&&setInterval(f,a.interval)});f()})}})}});
